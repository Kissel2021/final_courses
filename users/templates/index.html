{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}

{% if user.is_authenticated %}
<h2 style="margin-top:0;">–ü—Ä–∏–≤–µ—Ç, {{ user.first_name }} üëã</h2>

<div id="chat-window" style="padding:20px; background:white; border-radius:10px; max-width:800px; margin:auto;
     height:500px; overflow-y:auto; border:1px solid #ddd;">
</div>

<input id="user-input" type="text" placeholder="–ù–∞–ø–∏—à–∏ –∂–∞–Ω—Ä—ã (–ø—Ä–∏–º–µ—Ä: —Ö–æ—Ä—Ä–æ—Ä, –∫–æ–æ–ø)"
   style="width:100%; margin-top:10px; padding:12px; border-radius:8px; border:1px solid #ccc;">
<button id="send-btn"
  style="margin-top:10px; padding:10px 18px; background:#0d6efd; color:white; border:none; border-radius:6px;">
  –û—Ç–ø—Ä–∞–≤–∏—Ç—å
</button>

<script>
const chatWindow = document.getElementById("chat-window");
const inp = document.getElementById("user-input");
const btn = document.getElementById("send-btn");

function addUserMsg(t) {
  chatWindow.innerHTML += `<div style="text-align:right; margin:8px 0;">
      <span style="display:inline-block; background:#0d6efd; color:white; padding:8px 12px; border-radius:12px;">
      ${t}</span></div>`;
}

function addBotMsg(t) {
  chatWindow.innerHTML += `<div style="text-align:left; margin:8px 0;">
     <div style="display:inline-block; background:#eee; padding:10px; border-radius:12px;
         max-width:80%; text-align:left;">${t}</div></div>`;
}

function send(){
  let q = inp.value;
  if(!q) return;
  addUserMsg(q);
  inp.value = "";
  fetch("{% url 'recommendations:ask_game' %}", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({query:q})
  }).then(r=>r.json()).then(data=>{
    addBotMsg(data.answer);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  });
}

btn.onclick = send;
inp.onkeypress = (e)=>{ if(e.key==="Enter") send();}
</script>

{% else %}

    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
    <p>–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥–±–æ—Ä–∫–∏ –∏–≥—Ä ‚Äî –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.</p>

    <a href="{% url 'users:login' %}"
       style="background:#0d6efd;color:white;padding:10px 18px;border-radius:6px;text-decoration:none;">
       –í–æ–π—Ç–∏
    </a>

    <a href="{% url 'users:register' %}"
       style="margin-left:10px;background:#198754;color:white;padding:10px 18px;border-radius:6px;text-decoration:none;">
       –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    </a>

{% endif %}

{% endblock %}
